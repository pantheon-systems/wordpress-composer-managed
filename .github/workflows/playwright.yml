name: WordPress Composer Playwright Tests
on:
  pull_request:
    types:
      - opened
      - reopened
      - synchronize
      - ready_for_review

permissions:
    contents: write

jobs:
  playwright-single:
    name: Single site
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run Single Site Tests
        uses: ./.github/workflows/run-playwright-tests
        with:
          site_id: wpcm-playwright-tests
          site_name: WordPress (Composer Managed) Single Site Test
          site_url: https://dev-wpcm-playwright-tests.pantheonsite.io
          type: single
          os: ${{ runner.os }}
          ssh_key: ${{ secrets.SSH_PRIVATE_KEY }}
          terminus_token: ${{ secrets.TERMINUS_TOKEN }}
          github_token: ${{ github.token }}
          pr: ${{ github.event.pull_request.number }}
          workspace: ${{ github.workspace }}
  playwright-subdir:
    name: Subdirectory multisite
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Run Subdirectory Multisite Tests
        uses: ./.github/workflows/run-playwright-tests
        with:
          site_id: wpcm-subdir-playwright-tests
          site_name: WordPress (Composer Managed) Subdirectory Multisite Test
          site_url: https://dev-wpcm-playwright-tests.pantheonsite.io
          type: subdir
          os: ${{ runner.os }}
          ssh_key: ${{ secrets.SSH_PRIVATE_KEY }}
          terminus_token: ${{ secrets.TERMINUS_TOKEN }}
          github_token: ${{ github.token }}
          pr: ${{ github.event.pull_request.number }}
          workspace: ${{ github.workspace }}
